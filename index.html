<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Long Entropy Capital</title>
    <link rel="icon" href="favicon.png">
    <meta name="description" content="Long Entropy Capital — AUM and Portfolio Breakdown" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
      :root {
        --bg: #0b0b0d;
        --card: #121216;
        --text: #e9e9ef;
        --muted: #a8a8b3;
        --accent: #ff9900; /* Bitcoin orange */
        --ring: rgba(255,153,0,0.25);
      }
      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        background: radial-gradient(1200px 800px at 20% -10%, #191923, transparent 60%), var(--bg);
        color: var(--text);
        -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility;
      }
      a { color: var(--text); text-decoration: none; }
      a:hover { color: var(--accent); }
      .wrap { max-width: 1100px; margin: 0 auto; padding: 28px 20px 80px; }
      header { display: flex; align-items: center; gap: 16px; }
      header img.logo { height: 56px; width: auto; filter: drop-shadow(0 2px 8px rgba(0,0,0,0.35)); }
      header .brand { display: flex; flex-direction: column; }
      header h1 { margin: 0; font-size: clamp(26px, 4vw, 36px); letter-spacing: 0.3px; }
      header p.tag { margin: 2px 0 0; color: var(--muted); font-size: 14px; }

      .grid { display: grid; grid-template-columns: 1fr; gap: 20px; margin-top: 28px; }
      @media (min-width: 900px) { .grid { grid-template-columns: 420px 1fr; } }

      .card { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border: 1px solid rgba(255,255,255,0.06); border-radius: 18px; padding: 18px; box-shadow: 0 12px 30px rgba(0,0,0,0.30); }
      .card h2 { margin: 2px 0 8px; font-size: 18px; color: #f5f5fb; }
      .card .sub { color: var(--muted); font-size: 13px; margin-bottom: 10px; }

      .aum { display: grid; gap: 8px; }
      .aum .value { font-size: clamp(36px, 6vw, 56px); font-weight: 800; letter-spacing: -0.5px; }
      .aum .updated { color: var(--muted); font-size: 13px; }

      .pie-wrap { position: relative; min-height: 360px; }
      canvas { width: 100% !important; height: 360px !important; }

      table { width: 100%; border-collapse: collapse; font-size: 14px; }
      thead th { text-align: left; color: var(--muted); font-weight: 600; border-bottom: 1px solid rgba(255,255,255,0.08); padding: 10px 8px; }
      tbody td { padding: 10px 8px; border-bottom: 1px dashed rgba(255,255,255,0.06); }
      tbody tr:hover { background: rgba(255,255,255,0.02); }
      .right { text-align: right; }
      .chip { font-size: 12px; padding: 4px 8px; border-radius: 999px; background: rgba(255,153,0,0.14); color: var(--accent); border: 1px solid var(--ring); }

      footer { margin-top: 36px; color: var(--muted); font-size: 14px; display: flex; gap: 14px; align-items: center; justify-content: space-between; flex-wrap: wrap; }
      .email { display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; border: 1px solid rgba(255,255,255,0.06); border-radius: 999px; background: rgba(255,255,255,0.02); }
      .email:hover { border-color: var(--ring); box-shadow: 0 0 0 6px var(--ring) inset; }

      .hint { font-size: 12px; color: var(--muted); }
      .err { color: #fba6a6; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <!-- Place your logo file named 'satssymbol.png' in the same folder as this index.html -->
        <img class="logo" src="satssymbol.png" alt="Long Entropy Capital logo" />
        <div class="brand">
          <h1>Long Entropy Capital</h1>
          <p class="tag">Digital Capital × Digital Intelligence</p>
        </div>
      </header>

      <div class="grid">
        <section class="card">
          <h2>Assets Under Management</h2>
          <div class="sub">Sourced live from Google&nbsp;Sheets <span id="sheetState" class="chip">Loading…</span></div>
          <div class="aum">
            <div id="aumValue" class="value">—</div>
            <div class="updated">Last updated: <span id="lastUpdated">—</span></div>
            <div id="aumError" class="hint err" hidden></div>
            <!-- Tip: ensure your Sheet is set to <em>Anyone with the link can view</em> or <em>File → Share → Publish to web</em>. -->
          </div>
        </section>

        <section class="card">
          <h2>Portfolio Allocation</h2>
          <div class="sub">Breakdown adds to 100%</div>
          <div class="pie-wrap"><canvas id="pie"></canvas></div>
        </section>
      </div>

      <section class="card" style="margin-top:20px">
        <h2>Positions</h2>
        <table>
          <thead>
            <tr><th>Position</th><th class="right">Weight</th></tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </section>

      <footer>
        <div>
          <a class="email" href="mailto:hello@longentropycapital.com" aria-label="Email Long Entropy Capital">
            <!-- Simple envelope icon -->
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 5h18v14H3z" stroke="currentColor" stroke-width="1.5"/><path d="m3 7 9 7 9-7" stroke="currentColor" stroke-width="1.5"/></svg>
            hello@longentropycapital.com
          </a>
        </div>
        <div class="hint">© <span id="year"></span> Long Entropy Capital</div>
      </footer>
    </div>

    <script>
      // ========================
      //  CONFIG — update as needed
      // ========================
      const CONFIG = {
        sheetId: '1tDWV-I1m1CRoU00UNoVOLKlO94n2nKgFfAQ2snicRAU',
        sheetName: 'Dashboard',
        // AUM: provide a single-cell range like 'B2:B2' (value expected as number). Update to match your Dashboard.
        aumRange: 'L2:L2',
        // last updated date (optional). If you track a latest NAV date on the dashboard, point to that cell; otherwise we use today.
        lastUpdatedRange: 'B3:B3',
        // Portfolio table range with two columns: [Label, Weight].
        // Weight can be 0-1 (decimal) or 0-100 (percent); set weightIsPercent accordingly.
        portfolioRange: 'N16:O50',
        weightIsPercent: true,
      };

      // ========================
      //  UTILITIES
      // ========================
      const fmtUSD0 = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 });
      const fmtPct = new Intl.NumberFormat('en-US', { style: 'percent', maximumFractionDigits: 1 });

      function csvParse(text) {
        // Tiny CSV parser that handles quotes and commas
        const rows = []; let row = []; let cur = '';
        let i = 0, q = false;
        while (i < text.length) {
          const c = text[i];
          if (c === '"') {
            if (q && text[i+1] === '"') { cur += '"'; i++; }
            else { q = !q; }
          } else if (c === ',' && !q) { row.push(cur); cur=''; }
          else if ((c === '\n' || c === '\r') && !q) {
            if (cur !== '' || row.length) { row.push(cur); rows.push(row); row = []; cur=''; }
          } else { cur += c; }
          i++;
        }
        if (cur !== '' || row.length) { row.push(cur); rows.push(row); }
        return rows.filter(r => r.length && !r.every(x => x === ''));
      }

      async function fetchCSV(range) {
        const u = new URL(`https://docs.google.com/spreadsheets/d/${CONFIG.sheetId}/gviz/tq`);
        u.searchParams.set('tqx','out:csv');
        u.searchParams.set('sheet', CONFIG.sheetName);
        if (range) u.searchParams.set('range', range);
        const res = await fetch(u, { cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const txt = await res.text();
        return csvParse(txt);
      }

      function normalizeWeights(pairs) {
        let rows = pairs.filter(r => r[0] && r[1] !== undefined && r[1] !== '');
        let mapped = rows.map(([name, w]) => {
          let num = parseFloat(String(w).replace(/[%,$\s]/g,''));
          if (Number.isNaN(num)) return null;
          if (!CONFIG.weightIsPercent) num *= 100; // convert decimal → percent
          return { name: String(name).trim(), weight: num };
        }).filter(Boolean);
        const sum = mapped.reduce((a, r) => a + r.weight, 0);
        if (sum <= 0) return mapped;
        // Normalize softly to 100 while preserving proportions
        return mapped.map(r => ({ ...r, weight: r.weight * (100 / sum) }));
      }

      function renderTable(rows) {
        const tb = document.getElementById('rows');
        tb.innerHTML = '';
        rows.forEach(r => {
          const tr = document.createElement('tr');
          const tdA = document.createElement('td');
          const tdB = document.createElement('td');
          tdA.textContent = r.name;
          tdB.textContent = fmtPct.format(r.weight / 100);
          tdB.className = 'right';
          tr.append(tdA, tdB);
          tb.appendChild(tr);
        });
      }

      function renderPie(rows) {
        const ctx = document.getElementById('pie');
        if (window._pie) window._pie.destroy();
        const labels = rows.map(r => r.name);
        const data = rows.map(r => +(r.weight.toFixed(2)));
        window._pie = new Chart(ctx, {
          type: 'pie',
          data: { labels, datasets: [{ data }] },
          options: {
            plugins: {
              legend: { position: 'bottom', labels: { color: '#e6e6f0' } },
              tooltip: { callbacks: { label: (ctx) => `${ctx.label}: ${ctx.formattedValue}%` } }
            }
          }
        });
      }

      function animateAUM(target) {
        const el = document.getElementById('aumValue');
        const start = 0; const dur = 1000; const t0 = performance.now();
        function tick(t) {
          const p = Math.min(1, (t - t0) / dur);
          const v = start + (target - start) * p;
          el.textContent = fmtUSD0.format(v);
          if (p < 1) requestAnimationFrame(tick);
        }
        requestAnimationFrame(tick);
      }

      async function main() {
        document.getElementById('year').textContent = new Date().getFullYear();
        const state = document.getElementById('sheetState');
        try {
          // AUM
          const aumCells = await fetchCSV(CONFIG.aumRange);
          const rawAum = aumCells?.[0]?.[0] ?? '';
          let aum = parseFloat(String(rawAum).replace(/[$,\s]/g,''));
          if (!Number.isFinite(aum)) throw new Error('AUM cell is not numeric');
          animateAUM(aum);

          // Last updated (optional)
          try {
            const upd = await fetchCSV(CONFIG.lastUpdatedRange);
            const text = upd?.[0]?.[0] || new Date().toISOString().slice(0,10);
            document.getElementById('lastUpdated').textContent = String(text);
          } catch { document.getElementById('lastUpdated').textContent = new Date().toLocaleDateString(); }

          // Portfolio Table
          const rows = await fetchCSV(CONFIG.portfolioRange);
          const pairs = rows.map(r => [r[0], r[1]]);
          const normalized = normalizeWeights(pairs);
          renderTable(normalized);
          renderPie(normalized);
          state.textContent = 'Live';
          state.style.background = 'rgba(0,255,153,0.12)';
          state.style.color = '#6dffb8';
          state.style.borderColor = 'rgba(0,255,153,0.25)';
        } catch (err) {
          console.error(err);
          document.getElementById('aumError').hidden = false;
          document.getElementById('aumError').textContent = 'Could not load from Google Sheets. Check sharing permissions and the configured ranges in the code.';
          state.textContent = 'Offline';
          state.style.background = 'rgba(255,0,102,0.12)';
          state.style.color = '#ff99b0';
          state.style.borderColor = 'rgba(255,0,102,0.25)';
        }
      }

      main();
    </script>

    <!--
    HOW TO DEPLOY
    1) Put this single file (index.html) and your logo file (satssymbol.png) in a GitHub Pages repo or any static host.
    2) Make sure the Google Sheet is viewable to anyone with the link (or Publish to the web).
    3) Update CONFIG ranges to match your Dashboard tab:
       - aumRange       → single cell containing numeric AUM (e.g., 'B2:B2')
       - lastUpdatedRange→ optional date cell (e.g., 'B3:B3')
       - portfolioRange → two columns: [Position, Weight] (e.g., 'A5:B50')
       - weightIsPercent→ true if weights are 0–100, false if 0–1
    4) The pie and table will auto‑normalize to 100%.
    -->
  </body>
</html>
