<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Long Entropy Capital</title>
    <meta name="description" content="Long Entropy Capital â€” AUM and Portfolio Breakdown" />
    <link rel="icon" type="image/png" href="satssymbol.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
      :root {
        color-scheme: dark;
        --bg: #0f1010;
        --surface: #181a1b;
        --text: #f7f8f8;
        --muted: #dfe1e2;
        --accent: #ff9900; /* Bitcoin orange */
        --ring: rgba(255,153,0,0.25);
        --card-border: rgba(255,255,255,0.06);
        --table-border: rgba(255,255,255,0.08);
        --table-row-border: rgba(255,255,255,0.06);
        --table-row-hover: rgba(255,255,255,0.04);
        --email-bg: rgba(255,255,255,0.02);
        --email-border: rgba(255,255,255,0.06);
        --shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
        --chip-bg: rgba(255,153,0,0.14);
        --chip-border: rgba(255,153,0,0.25);
        --background-image: radial-gradient(1200px 800px at 20% -10%, rgba(25, 25, 35, 0.75), transparent 60%);
        --tooltip-bg: #1f1f26;
      }

      :root[data-theme="light"] {
        color-scheme: light;
        --bg: #f7f8f8;
        --surface: #ffffff;
        --text: #181a1b;
        --muted: #3d4143;
        --card-border: rgba(24, 26, 27, 0.08);
        --table-border: rgba(24, 26, 27, 0.12);
        --table-row-border: rgba(24, 26, 27, 0.08);
        --table-row-hover: rgba(24, 26, 27, 0.04);
        --email-bg: rgba(24, 26, 27, 0.04);
        --email-border: rgba(24, 26, 27, 0.12);
        --shadow: 0 12px 30px rgba(15, 16, 16, 0.14);
        --chip-bg: rgba(255,153,0,0.12);
        --chip-border: rgba(255,153,0,0.2);
        --background-image: none;
        --tooltip-bg: #ffffff;
      }
      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        background-color: var(--bg);
        background-image: var(--background-image);
        color: var(--text);
        -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility;
        transition: background-color 0.3s ease, color 0.3s ease;
      }
      a { color: var(--text); text-decoration: none; }
      a:hover { color: var(--accent); }
      .wrap { max-width: 1100px; margin: 0 auto; padding: 28px 20px 80px; }
      header { display: flex; align-items: center; justify-content: space-between; gap: 16px; flex-wrap: wrap; }
      .identity { display: flex; align-items: center; gap: 16px; }
      header img.logo { height: 56px; width: auto; filter: drop-shadow(0 2px 8px rgba(0,0,0,0.35)); }
      header .brand { display: flex; flex-direction: column; }
      header h1 { margin: 0; font-size: clamp(26px, 4vw, 36px); letter-spacing: 0.3px; }
      header p.tag { margin: 2px 0 0; color: var(--muted); font-size: 14px; }
      .theme-toggle {
        margin-left: auto;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 14px;
        border: 1px solid var(--card-border);
        border-radius: 999px;
        background: var(--surface);
        color: var(--text);
        font: inherit;
        font-size: 14px;
        cursor: pointer;
        transition: color 0.2s ease, border-color 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease;
      }
      .theme-toggle:hover { border-color: var(--ring); box-shadow: 0 0 0 6px var(--ring) inset; }
      .theme-toggle:focus { outline: 2px solid var(--accent); outline-offset: 2px; }
      .theme-toggle:focus:not(:focus-visible) { outline: none; }
      .theme-toggle:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
      .theme-toggle .icon { font-size: 16px; line-height: 1; }

      .grid { display: grid; grid-template-columns: 1fr; gap: 20px; margin-top: 28px; }
      @media (min-width: 900px) { .grid { grid-template-columns: 420px 1fr; } }

      .card { background: var(--surface); border: 1px solid var(--card-border); border-radius: 18px; padding: 18px; box-shadow: var(--shadow); transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease; }
      .card h2 { margin: 2px 0 8px; font-size: 18px; color: var(--text); }
      .card-head { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
      .card-head h2 { margin: 2px 0 0; }
      .card .sub { color: var(--muted); font-size: 13px; margin-bottom: 10px; }

      .aum { display: grid; gap: 8px; }
      .aum .value { font-size: clamp(36px, 6vw, 56px); font-weight: 800; letter-spacing: -0.5px; }
      .aum .updated { color: var(--muted); font-size: 13px; }

      .pie-wrap {
        position: relative;
        width: min(100%, 420px);
        margin: 0 auto;
        aspect-ratio: 1 / 1;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      canvas { width: 100% !important; height: 100% !important; }

      table { width: 100%; border-collapse: collapse; font-size: 14px; }
      thead th { text-align: left; color: var(--muted); font-weight: 600; border-bottom: 1px solid var(--table-border); padding: 10px 8px; }
      tbody td { padding: 10px 8px; border-bottom: 1px dashed var(--table-row-border); }
      tbody tr:hover { background: var(--table-row-hover); }
      .right { text-align: right; }
      .chip { font-size: 12px; padding: 4px 8px; border-radius: 999px; background: var(--chip-bg); color: var(--accent); border: 1px solid var(--chip-border); }

      footer { margin-top: 36px; color: var(--muted); font-size: 14px; display: flex; gap: 14px; align-items: center; justify-content: space-between; flex-wrap: wrap; }
      .email {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        border: 1px solid var(--email-border);
        border-radius: 999px;
        background: var(--email-bg);
        color: var(--text);
        cursor: pointer;
        font: inherit;
        line-height: 1.4;
        appearance: none;
        -webkit-appearance: none;
        transition: color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
      }
      .email:hover { border-color: var(--ring); box-shadow: 0 0 0 6px var(--ring) inset; }
      .email:focus { outline: 2px solid var(--accent); outline-offset: 2px; }
      .email:focus:not(:focus-visible) { outline: none; }
      .email:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
      .email svg { pointer-events: none; flex-shrink: 0; }
      .email .email-text { transition: color 0.2s ease; }
      .email.copied { border-color: var(--accent); box-shadow: 0 0 0 6px var(--ring) inset; color: var(--accent); }
      .email.copied .email-text { color: var(--accent); }

      .hint { font-size: 12px; color: var(--muted); }
      .err { color: #fba6a6; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <!-- Place your logo file named 'satssymbol.png' in the same folder as this index.html -->
        <div class="identity">
          <img class="logo" src="satssymbol.png" alt="Long Entropy Capital logo" />
          <div class="brand">
            <h1>Long Entropy Capital</h1>
          </div>
        </div>
        <button class="theme-toggle" type="button" aria-label="Switch to light mode" title="Switch to light mode">
          <span class="icon" aria-hidden="true">ðŸŒ™</span>
          <span class="label">Dark</span>
        </button>
      </header>

      <div class="grid">
        <section class="card">
          <div class="card-head">
            <h2>Assets Under Management</h2>
            <span id="sheetState" class="chip">Loadingâ€¦</span>
          </div>
          <div class="aum">
            <div id="aumValue" class="value">â€”</div>
            <div class="updated">Last updated: <span id="lastUpdated">â€”</span></div>
            <div id="aumError" class="hint err" hidden></div>
            <!-- Tip: ensure your Sheet is set to <em>Anyone with the link can view</em> or <em>File â†’ Share â†’ Publish to web</em>. -->
          </div>
        </section>

        <section class="card">
          <h2>Portfolio Allocation</h2>
          <div class="pie-wrap"><canvas id="pie"></canvas></div>
        </section>
      </div>

      <section class="card" style="margin-top:20px">
        <h2>Positions</h2>
        <table>
          <thead>
            <tr><th>Position</th><th class="right">Weight</th></tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </section>

      <footer>
        <div>
          <button class="email" type="button" data-email="hello@longentropycapital.com" aria-label="Copy email address" title="Copy email address to clipboard">
            <!-- Simple envelope icon -->
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 5h18v14H3z" stroke="currentColor" stroke-width="1.5"/><path d="m3 7 9 7 9-7" stroke="currentColor" stroke-width="1.5"/></svg>
            <span class="email-text" data-default="hello@longentropycapital.com" aria-live="polite">hello@longentropycapital.com</span>
          </button>
        </div>
        <div class="hint">Â© <span id="year"></span> Long Entropy Capital</div>
      </footer>
    </div>

    <script>
      const THEME_STORAGE_KEY = 'lec-theme';
      let lastPortfolioRows = null;

      function getStoredTheme() {
        try {
          const value = localStorage.getItem(THEME_STORAGE_KEY);
          return value === 'light' || value === 'dark' ? value : null;
        } catch {
          return null;
        }
      }

      function getSystemTheme() {
        return window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
      }

      function applyTheme(theme, { persist = true } = {}) {
        const root = document.documentElement;
        root.dataset.theme = theme;
        if (persist) {
          try { localStorage.setItem(THEME_STORAGE_KEY, theme); } catch {}
        }
        const button = document.querySelector('.theme-toggle');
        if (button) {
          const icon = button.querySelector('.icon');
          const label = button.querySelector('.label');
          const isLight = theme === 'light';
          const nextTheme = isLight ? 'dark' : 'light';
          if (icon) icon.textContent = isLight ? 'ðŸŒž' : 'ðŸŒ™';
          if (label) label.textContent = isLight ? 'Light' : 'Dark';
          button.setAttribute('aria-label', `Switch to ${nextTheme} mode`);
          button.setAttribute('title', `Switch to ${nextTheme} mode`);
        }
        if (lastPortfolioRows) {
          renderPie(lastPortfolioRows);
        }
      }

      function setupThemeToggle() {
        const button = document.querySelector('.theme-toggle');
        if (!button) return;
        button.addEventListener('click', () => {
          const current = document.documentElement.dataset.theme === 'light' ? 'light' : 'dark';
          const next = current === 'light' ? 'dark' : 'light';
          applyTheme(next);
        });
      }

      function watchSystemTheme() {
        if (!window.matchMedia) return;
        const media = window.matchMedia('(prefers-color-scheme: light)');
        const handler = (event) => {
          if (getStoredTheme()) return;
          applyTheme(event.matches ? 'light' : 'dark', { persist: false });
        };
        if (typeof media.addEventListener === 'function') {
          media.addEventListener('change', handler);
        } else if (typeof media.addListener === 'function') {
          media.addListener(handler);
        }
      }

      const storedThemePreference = getStoredTheme();
      applyTheme(storedThemePreference || getSystemTheme(), { persist: false });
      setupThemeToggle();
      watchSystemTheme();

      // ========================
      //  CONFIG â€” update as needed
      // ========================
      const CONFIG = {
        sheetId: '1tDWV-I1m1CRoU00UNoVOLKlO94n2nKgFfAQ2snicRAU',
        sheetName: 'Dashboard',
        // AUM: provide a single-cell range like 'B2:B2' (value expected as number). Update to match your Dashboard.
        aumRange: 'L2:L2',
        // last updated date (optional). If you track a latest NAV date on the dashboard, point to that cell; otherwise we use today.
        lastUpdatedRange: 'B3:B3',
        // Portfolio table range with two columns: [Label, Weight].
        // Weight can be 0-1 (decimal) or 0-100 (percent); set weightIsPercent accordingly.
        portfolioRange: 'N16:O50',
        weightIsPercent: true,
      };

      const PIE_COLORS = [
        '#5b6c94', // muted indigo
        '#7d8fa7', // soft steel blue
        '#a6b5c6', // airy blue grey
        '#a4b79e', // gentle sage
        '#c7b8a4', // warm sand
        '#b299a6', // dusky mauve
        '#7a8c89', // slate green
        '#c5c7d3', // periwinkle grey
        '#b0c4bc', // muted mint
        '#d9cec2', // light stone
      ];

      function getPieColors(count) {
        const colors = [];
        for (let i = 0; i < count; i++) {
          colors.push(PIE_COLORS[i % PIE_COLORS.length]);
        }
        return colors;
      }

      // ========================
      //  UTILITIES
      // ========================
      const fmtUSD0 = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 });
      const fmtPct = new Intl.NumberFormat('en-US', { style: 'percent', maximumFractionDigits: 1 });

      function csvParse(text) {
        // Tiny CSV parser that handles quotes and commas
        const rows = []; let row = []; let cur = '';
        let i = 0, q = false;
        while (i < text.length) {
          const c = text[i];
          if (c === '"') {
            if (q && text[i+1] === '"') { cur += '"'; i++; }
            else { q = !q; }
          } else if (c === ',' && !q) { row.push(cur); cur=''; }
          else if ((c === '\n' || c === '\r') && !q) {
            if (cur !== '' || row.length) { row.push(cur); rows.push(row); row = []; cur=''; }
          } else { cur += c; }
          i++;
        }
        if (cur !== '' || row.length) { row.push(cur); rows.push(row); }
        return rows.filter(r => r.length && !r.every(x => x === ''));
      }

      async function fetchCSV(range) {
        const u = new URL(`https://docs.google.com/spreadsheets/d/${CONFIG.sheetId}/gviz/tq`);
        u.searchParams.set('tqx','out:csv');
        u.searchParams.set('sheet', CONFIG.sheetName);
        if (range) u.searchParams.set('range', range);
        const res = await fetch(u, { cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const txt = await res.text();
        return csvParse(txt);
      }

      function normalizeWeights(pairs) {
        let rows = pairs.filter(r => r[0] && r[1] !== undefined && r[1] !== '');
        let mapped = rows.map(([name, w]) => {
          let num = parseFloat(String(w).replace(/[%,$\s]/g,''));
          if (Number.isNaN(num)) return null;
          if (!CONFIG.weightIsPercent) num *= 100; // convert decimal â†’ percent
          return { name: String(name).trim(), weight: num };
        }).filter(Boolean);
        const sum = mapped.reduce((a, r) => a + r.weight, 0);
        if (sum <= 0) return mapped;
        // Normalize softly to 100 while preserving proportions
        return mapped.map(r => ({ ...r, weight: r.weight * (100 / sum) }));
      }

      function renderTable(rows) {
        const tb = document.getElementById('rows');
        tb.innerHTML = '';
        rows.forEach(r => {
          const tr = document.createElement('tr');
          const tdA = document.createElement('td');
          const tdB = document.createElement('td');
          tdA.textContent = r.name;
          tdB.textContent = fmtPct.format(r.weight / 100);
          tdB.className = 'right';
          tr.append(tdA, tdB);
          tb.appendChild(tr);
        });
      }

      async function copyToClipboard(text) {
        if (navigator.clipboard?.writeText) {
          await navigator.clipboard.writeText(text);
          return;
        }
        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.setAttribute('readonly', '');
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        textarea.style.pointerEvents = 'none';
        document.body.appendChild(textarea);
        textarea.select();
        const ok = document.execCommand('copy');
        document.body.removeChild(textarea);
        if (!ok) throw new Error('Copy command was unsuccessful');
      }

      function setupEmailCopy() {
        const button = document.querySelector('.email[data-email]');
        if (!button) return;
        const email = button.dataset.email;
        const label = button.querySelector('.email-text');
        const defaultText = label?.dataset.default || label?.textContent?.trim() || email;
        let resetTimer;
        button.addEventListener('click', async (event) => {
          event.preventDefault();
          clearTimeout(resetTimer);
          let success = false;
          try {
            await copyToClipboard(email);
            success = true;
          } catch (err) {
            console.error('Failed to copy email', err);
          }
          if (success) {
            button.classList.add('copied');
            if (label) label.textContent = 'Copied!';
          } else {
            button.classList.remove('copied');
            if (label) label.textContent = 'Unable to copy';
          }
          resetTimer = setTimeout(() => {
            button.classList.remove('copied');
            if (label) label.textContent = defaultText;
          }, 2000);
        });
      }

      function renderPie(rows) {
        lastPortfolioRows = rows;
        const ctx = document.getElementById('pie');
        if (window._pie) window._pie.destroy();
        const labels = rows.map(r => r.name);
        const data = rows.map(r => +(r.weight.toFixed(2)));
        codex/add-dark-and-light-mode-toggle-p1fnjo
        const styles = getComputedStyle(document.documentElement);
        const legendColor = styles.getPropertyValue('--muted').trim() || '#cccccc';
        const tooltipColor = styles.getPropertyValue('--text').trim() || '#ffffff';
        const tooltipBg = styles.getPropertyValue('--tooltip-bg').trim() || '#1f1f26';

        const colors = getPieColors(data.length);
         main
        window._pie = new Chart(ctx, {
          type: 'pie',
          data: {
            labels,
            datasets: [{
              data,
              backgroundColor: colors,
              borderColor: '#0b0b0d',
              borderWidth: 2,
              borderRadius: 6,
              hoverOffset: 10,
            }],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            layout: { padding: 12 },
            plugins: {
       codex/add-dark-and-light-mode-toggle-p1fnjo
              legend: { position: 'bottom', labels: { color: legendColor } },
              tooltip: {
                backgroundColor: tooltipBg,
                titleColor: tooltipColor,
                bodyColor: tooltipColor,
                callbacks: { label: (ctx) => `${ctx.label}: ${ctx.formattedValue}%` }
              }
            }
          }

              legend: {
                position: 'bottom',
                align: 'center',
                labels: {
                  color: '#d6d6dd',
                  usePointStyle: true,
                  pointStyle: 'circle',
                  padding: 16,
                  boxWidth: 10,
                  boxHeight: 10,
                  font: {
                    family: 'Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif',
                    size: 12,
                  },
                },
              },
              tooltip: {
                backgroundColor: 'rgba(18,18,22,0.85)',
                borderColor: 'rgba(255,255,255,0.08)',
                borderWidth: 1,
                titleColor: '#f5f5fb',
                bodyColor: '#f5f5fb',
                padding: 10,
                callbacks: {
                  label: (ctx) => `${ctx.label}: ${ctx.formattedValue}%`,
                },
              },
            },
            animation: {
              animateRotate: true,
              animateScale: true,
              duration: 900,
              easing: 'easeOutQuart',
            },
          },
        main
        });
      }

      function animateAUM(target) {
        const el = document.getElementById('aumValue');
        const start = 0; const dur = 1000; const t0 = performance.now();
        function tick(t) {
          const p = Math.min(1, (t - t0) / dur);
          const v = start + (target - start) * p;
          el.textContent = fmtUSD0.format(v);
          if (p < 1) requestAnimationFrame(tick);
        }
        requestAnimationFrame(tick);
      }

      async function main() {
        document.getElementById('year').textContent = new Date().getFullYear();
        const state = document.getElementById('sheetState');
        try {
          // AUM
          const aumCells = await fetchCSV(CONFIG.aumRange);
          const rawAum = aumCells?.[0]?.[0] ?? '';
          let aum = parseFloat(String(rawAum).replace(/[$,\s]/g,''));
          if (!Number.isFinite(aum)) throw new Error('AUM cell is not numeric');
          animateAUM(aum);

          // Last updated (optional)
          try {
            const upd = await fetchCSV(CONFIG.lastUpdatedRange);
            const text = upd?.[0]?.[0] || new Date().toISOString().slice(0,10);
            document.getElementById('lastUpdated').textContent = String(text);
          } catch { document.getElementById('lastUpdated').textContent = new Date().toLocaleDateString(); }

          // Portfolio Table
          const rows = await fetchCSV(CONFIG.portfolioRange);
          const pairs = rows.map(r => [r[0], r[1]]);
          const normalized = normalizeWeights(pairs);
          renderTable(normalized);
          renderPie(normalized);
          state.textContent = 'Live';
          state.style.background = 'rgba(0,255,153,0.12)';
          state.style.color = '#6dffb8';
          state.style.borderColor = 'rgba(0,255,153,0.25)';
        } catch (err) {
          console.error(err);
          document.getElementById('aumError').hidden = false;
          document.getElementById('aumError').textContent = 'Could not load from Google Sheets. Check sharing permissions and the configured ranges in the code.';
          state.textContent = 'Offline';
          state.style.background = 'rgba(255,0,102,0.12)';
          state.style.color = '#ff99b0';
          state.style.borderColor = 'rgba(255,0,102,0.25)';
        }
      }

      setupEmailCopy();
      main();
    </script>

    <!--
    HOW TO DEPLOY
    1) Put this single file (index.html) and your logo file (satssymbol.png) in a GitHub Pages repo or any static host.
    2) Make sure the Google Sheet is viewable to anyone with the link (or Publish to the web).
    3) Update CONFIG ranges to match your Dashboard tab:
       - aumRange       â†’ single cell containing numeric AUM (e.g., 'B2:B2')
       - lastUpdatedRangeâ†’ optional date cell (e.g., 'B3:B3')
       - portfolioRange â†’ two columns: [Position, Weight] (e.g., 'A5:B50')
       - weightIsPercentâ†’ true if weights are 0â€“100, false if 0â€“1
    4) The pie and table will autoâ€‘normalize to 100%.
    -->
  </body>
</html>
